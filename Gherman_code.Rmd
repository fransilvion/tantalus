---
title: 'Serratus: new format'
author: "German Novakovskiy"
date: "May 27, 2020"
output: html_document
---

```{r, include=FALSE}
# Acquire data (run once)
system('mkdir -p 200527')
system('aws s3 sync s3://serratus-public/out/200525_vert/summary/ 200527/')
```

```{r setup, include=FALSE}
#library("RSQLite")
#library("jsonlite")
library("tantalus")
library("ggplot2")
library("gridExtra")
library("dplyr")
#for exploring
library("plotly")
library("grid")

```

```{r}

```

```{r, include = FALSE}
#DATA_PATH='../200528_viro/'
DATA_PATH='../200525_vert/'
sumWheres <- paste0( DATA_PATH,
                     system( paste0("ls ", DATA_PATH), intern = T ))

#ZOO <- readSerratus( sumWheres )

#for (f in sumWheres){
  #print(f)
  #test <- readSerratus( f )
#}

start.time <- Sys.time()

#ZOO <- readSerratus( sumWheres )
VERT <- readSerratus( sumWheres )

end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken

#save(ZOO, file="../ZOO.RData")
save(VERT, file="../VERT.RData")

load("../VERT.RData")

#magor_problem <- c("../200528_viro/ERR2002982.summary")
#x <- readSerratus( magor_problem )

x <- readSerratus( "../test.summary" )

```

```{r}
familyScore(VERT, "Coronaviridae")
```

```{r}
x <- familyScorPctID(VERT, "Coronaviridae")
x
```

```{r}
p1 <- familyPctID(VERT, "Coronaviridae", score_threshold = 0, title="Coronaviridae - all", x1=70, x2=100)
p2 <- familyPctID(VERT, "Coronaviridae", score_threshold = 50, title="Coronaviridae - 50+", x1=70, x2=100)
p3 <- familyPctID(VERT, "Coronaviridae", score_threshold = 60, title="Coronaviridae - 60+", x1=70, x2=100)
p4 <- familyPctID(VERT, "Coronaviridae", score_threshold = 70, title="Coronaviridae - 70+", x1=70, x2=100)
p5 <- familyPctID(VERT, "Coronaviridae", score_threshold = 80, title="Coronaviridae - 80+", x1=70, x2=100)
p6 <- familyPctID(VERT, "Coronaviridae", score_threshold = 90, title="Coronaviridae - 90+", x1=70, x2=100)

grid.newpage()
grid.draw(rbind(ggplotGrob(p1),
                ggplotGrob(p2),
                ggplotGrob(p3),
                ggplotGrob(p4),
                ggplotGrob(p5),
                ggplotGrob(p6),
                size = "last"))
```
