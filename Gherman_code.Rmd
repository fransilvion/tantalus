---
title: 'Serratus: new format'
author: "German Novakovskiy"
date: "May 27, 2020"
output: html_document
---

```{r, include=FALSE}
# Acquire data (run once)
system('mkdir -p 200527')
system('aws s3 sync s3://serratus-public/out/200525_vert/summary/ 200527/')
```

```{r setup, include=FALSE}
#library("RSQLite")
#library("jsonlite")
library("tantalus")
library("ggplot2")
library("gridExtra")
library("dplyr")
#for exploring
library("plotly")

```

```{r}
#Function – familyScore: input the serratus object; output – ggplot – full page with all families;
#histogram with family scores;
familyScore <- function(){
  
}

```

```{r, include = FALSE}
DATA_PATH='../200528_viro/'
sumWheres <- paste0( DATA_PATH,
                     system( paste0("ls ", DATA_PATH), intern = T ))

#ZOO <- readSerratus( sumWheres )

#for (f in sumWheres){
  #print(f)
  #test <- readSerratus( f )
#}

start.time <- Sys.time()

ZOO <- readSerratus( sumWheres )

end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken

save(ZOO, file="../ZOO.RData")

#magor_problem <- c("../200528_viro/ERR2002982.summary")
#x <- readSerratus( magor_problem )

x <- readSerratus( "../test.summary" )

```

```{r}
#TEST
families <- unique(ZOO@family$family)
Coronaviridae <- ZOO@family %>% filter(family %in% c("Coronaviridae"))

#fig <- plot_ly(x = Coronaviridae$score, type = "histogram")
#fig

ggplot(data=Coronaviridae, aes(Coronaviridae$score)) + 
  geom_histogram(fill="blue", bins = 100) +
  theme_bw() +
  labs(x = "Family score") +
  labs(title = "Coronaviridae family")
```

```{r}
#TEST
#familyScorPctID function – input serratus objects; output – ggplot with scatter plot
ggplot(data=Coronaviridae, aes(x=Coronaviridae$score, y=Coronaviridae$pctid)) +
  geom_point(size=3, color="blue") + 
  theme_bw() +
  labs(x = "Family score", y = "Percentage identity") +
  labs(title = "Coronaviridae family")
```
```{r}
ggplot(data=Coronaviridae, aes(x=Coronaviridae$score, y=Coronaviridae$pctid)) +
  geom_hex(bins=30) + 
  theme_bw() +
  labs(x = "Family score", y = "Percentage identity") +
  labs(title = "Coronaviridae family")
```

